#!/bin/sh
. "$(dirname "$0")/common.sh"

echo "ğŸ” Running pre-commit checks..."
echo ""

# Run lint-staged for auto-fixes on changed files
echo "ğŸ“ Auto-fixing changed files with lint-staged..."
pnpm exec lint-staged

# Type check all files (catches errors in unchanged files that depend on changed code)
echo ""
echo "ğŸ” Running TypeScript type check..."
if ! pnpm run typecheck; then
  print_error "TypeScript errors found. Please fix them before committing."
  echo ""
  echo "ğŸ’¡ To bypass this check (emergency only): git commit --no-verify"
  exit 1
fi

# Lint all files (catches errors that may have been introduced)
echo ""
echo "ğŸ”§ Running ESLint..."
if ! pnpm run lint; then
  print_error "ESLint errors found. Please fix them before committing."
  echo ""
  echo "ğŸ’¡ To bypass this check (emergency only): git commit --no-verify"
  exit 1
fi

echo ""
print_success "All pre-commit checks passed!"
